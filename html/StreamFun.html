<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>StreamFun</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Synchronous stream functions, used as semantics for Mealy machines</a>

<a id="72" class="Symbol">{-#</a> <a id="76" class="Keyword">OPTIONS</a> <a id="84" class="Pragma">--safe</a> <a id="91" class="Pragma">--without-K</a> <a id="103" class="Pragma">--copatterns</a> <a id="116" class="Pragma">--guardedness</a> <a id="130" class="Symbol">#-}</a>

<a id="135" class="Keyword">module</a> <a id="142" href="StreamFun.html" class="Module">StreamFun</a> <a id="152" class="Keyword">where</a>

<a id="159" class="Keyword">open</a> <a id="164" class="Keyword">import</a> <a id="171" href="Function.html" class="Module">Function</a> <a id="180" class="Keyword">using</a> <a id="186" class="Symbol">(</a><a id="187" href="Function.Base.html#3706" class="Function Operator">_∘′_</a><a id="191" class="Symbol">;</a> <a id="193" href="Function.Base.html#4121" class="Function Operator">case_of_</a><a id="201" class="Symbol">)</a> <a id="203" class="Keyword">renaming</a> <a id="212" class="Symbol">(</a><a id="213" href="Function.Base.html#615" class="Function">id</a> <a id="216" class="Symbol">to</a> <a id="Base.id"></a><a id="219" href="StreamFun.html#219" class="Function">id→</a><a id="222" class="Symbol">)</a>
<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="Data.Product.html" class="Module">Data.Product</a> <a id="249" class="Keyword">hiding</a> <a id="256" class="Symbol">(</a><a id="257" href="Data.Product.html#3060" class="Function">zip</a><a id="260" class="Symbol">)</a> <a id="262" class="Keyword">renaming</a> <a id="271" class="Symbol">(</a><a id="272" href="Data.Product.html#2486" class="Function">map</a> <a id="276" class="Symbol">to</a> <a id="Product.map"></a><a id="279" href="StreamFun.html#279" class="Function">map×</a><a id="283" class="Symbol">)</a>
<a id="285" class="Keyword">open</a> <a id="290" class="Keyword">import</a> <a id="297" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="328" class="Keyword">open</a> <a id="333" class="Keyword">import</a> <a id="340" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="349" class="Keyword">using</a> <a id="355" class="Symbol">(</a><a id="356" href="Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="359" class="Symbol">;</a> <a id="361" href="Data.Vec.Base.html#995" class="InductiveConstructor">[]</a><a id="363" class="Symbol">;</a> <a id="365" href="Data.Vec.Base.html#1014" class="InductiveConstructor Operator">_∷_</a><a id="368" class="Symbol">)</a>
<a id="370" class="Keyword">open</a> <a id="375" class="Keyword">import</a> <a id="382" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="420" class="Keyword">hiding</a> <a id="427" class="Symbol">(</a><a id="428" href="Relation.Binary.PropositionalEquality.html#1471" class="Function Operator">_≗_</a><a id="431" class="Symbol">)</a>

<a id="434" class="Keyword">private</a>
  <a id="444" class="Keyword">variable</a>
    <a id="457" href="StreamFun.html#457" class="Generalizable">A</a> <a id="459" href="StreamFun.html#459" class="Generalizable">B</a> <a id="461" href="StreamFun.html#461" class="Generalizable">C</a> <a id="463" href="StreamFun.html#463" class="Generalizable">D</a> <a id="465" class="Symbol">:</a> <a id="467" class="PrimitiveType">Set</a>

<a id="472" class="Keyword">record</a> <a id="Stream"></a><a id="479" href="StreamFun.html#479" class="Record">Stream</a> <a id="486" class="Symbol">(</a><a id="487" href="StreamFun.html#487" class="Bound">A</a> <a id="489" class="Symbol">:</a> <a id="491" class="PrimitiveType">Set</a><a id="494" class="Symbol">)</a> <a id="496" class="Symbol">:</a> <a id="498" class="PrimitiveType">Set</a> <a id="502" class="Keyword">where</a>
  <a id="510" class="Keyword">coinductive</a>
  <a id="524" class="Keyword">constructor</a> <a id="_∷′_"></a><a id="536" href="StreamFun.html#536" class="CoinductiveConstructor Operator">_∷′_</a>
  <a id="543" class="Keyword">field</a>
    <a id="Stream.hd"></a><a id="553" href="StreamFun.html#553" class="Field">hd</a> <a id="556" class="Symbol">:</a> <a id="558" href="StreamFun.html#487" class="Bound">A</a>
    <a id="Stream.tl"></a><a id="564" href="StreamFun.html#564" class="Field">tl</a> <a id="567" class="Symbol">:</a> <a id="569" href="StreamFun.html#479" class="Record">Stream</a> <a id="576" href="StreamFun.html#487" class="Bound">A</a>

<a id="579" class="Keyword">open</a> <a id="584" href="StreamFun.html#479" class="Module">Stream</a> <a id="591" class="Keyword">public</a>

<a id="599" class="Keyword">infix</a> <a id="605" class="Number">4</a> <a id="607" href="StreamFun.html#618" class="Record Operator">_≈_</a>
<a id="611" class="Keyword">record</a> <a id="_≈_"></a><a id="618" href="StreamFun.html#618" class="Record Operator">_≈_</a> <a id="622" class="Symbol">(</a><a id="623" href="StreamFun.html#623" class="Bound">xs</a> <a id="626" class="Symbol">:</a> <a id="628" href="StreamFun.html#479" class="Record">Stream</a> <a id="635" href="StreamFun.html#457" class="Generalizable">A</a><a id="636" class="Symbol">)</a> <a id="638" class="Symbol">(</a><a id="639" href="StreamFun.html#639" class="Bound">ys</a> <a id="642" class="Symbol">:</a> <a id="644" href="StreamFun.html#479" class="Record">Stream</a> <a id="651" href="StreamFun.html#457" class="Generalizable">A</a><a id="652" class="Symbol">)</a> <a id="654" class="Symbol">:</a> <a id="656" class="PrimitiveType">Set</a> <a id="660" class="Keyword">where</a>
  <a id="668" class="Keyword">coinductive</a>
  <a id="682" class="Comment">-- constructor ∷≈</a>
  <a id="702" class="Keyword">field</a>
    <a id="_≈_.hd-≈"></a><a id="712" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="717" class="Symbol">:</a> <a id="719" href="StreamFun.html#553" class="Field">hd</a> <a id="722" href="StreamFun.html#623" class="Bound">xs</a> <a id="725" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="727" href="StreamFun.html#553" class="Field">hd</a> <a id="730" href="StreamFun.html#639" class="Bound">ys</a>
    <a id="_≈_.tl-≈"></a><a id="737" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="742" class="Symbol">:</a> <a id="744" href="StreamFun.html#564" class="Field">tl</a> <a id="747" href="StreamFun.html#623" class="Bound">xs</a> <a id="750" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="752" href="StreamFun.html#564" class="Field">tl</a> <a id="755" href="StreamFun.html#639" class="Bound">ys</a>

<a id="759" class="Keyword">open</a> <a id="764" href="StreamFun.html#618" class="Module Operator">_≈_</a> <a id="768" class="Keyword">public</a>

<a id="776" class="Keyword">infix</a> <a id="782" class="Number">8</a> <a id="784" href="StreamFun.html#788" class="Function Operator">_!_</a>
<a id="_!_"></a><a id="788" href="StreamFun.html#788" class="Function Operator">_!_</a> <a id="792" class="Symbol">:</a> <a id="794" href="StreamFun.html#479" class="Record">Stream</a> <a id="801" href="StreamFun.html#457" class="Generalizable">A</a> <a id="803" class="Symbol">→</a> <a id="805" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="807" class="Symbol">→</a> <a id="809" href="StreamFun.html#457" class="Generalizable">A</a>
<a id="811" href="StreamFun.html#811" class="Bound">as</a> <a id="814" href="StreamFun.html#788" class="Function Operator">!</a> <a id="816" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a>  <a id="822" class="Symbol">=</a> <a id="824" href="StreamFun.html#553" class="Field">hd</a> <a id="827" href="StreamFun.html#811" class="Bound">as</a>
<a id="830" href="StreamFun.html#830" class="Bound">as</a> <a id="833" href="StreamFun.html#788" class="Function Operator">!</a> <a id="835" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="839" href="StreamFun.html#839" class="Bound">i</a> <a id="841" class="Symbol">=</a> <a id="843" href="StreamFun.html#564" class="Field">tl</a> <a id="846" href="StreamFun.html#830" class="Bound">as</a> <a id="849" href="StreamFun.html#788" class="Function Operator">!</a> <a id="851" href="StreamFun.html#839" class="Bound">i</a>

<a id="854" class="Comment">-- Mapping a function (combinational logic)</a>
<a id="map"></a><a id="898" href="StreamFun.html#898" class="Function">map</a> <a id="902" class="Symbol">:</a> <a id="904" class="Symbol">(</a><a id="905" href="StreamFun.html#457" class="Generalizable">A</a> <a id="907" class="Symbol">→</a> <a id="909" href="StreamFun.html#459" class="Generalizable">B</a><a id="910" class="Symbol">)</a> <a id="912" class="Symbol">→</a> <a id="914" href="StreamFun.html#479" class="Record">Stream</a> <a id="921" href="StreamFun.html#457" class="Generalizable">A</a> <a id="923" class="Symbol">→</a> <a id="925" href="StreamFun.html#479" class="Record">Stream</a> <a id="932" href="StreamFun.html#459" class="Generalizable">B</a>
<a id="934" href="StreamFun.html#553" class="Field">hd</a> <a id="937" class="Symbol">(</a><a id="938" href="StreamFun.html#898" class="Function">map</a> <a id="942" href="StreamFun.html#942" class="Bound">f</a> <a id="944" href="StreamFun.html#944" class="Bound">as</a><a id="946" class="Symbol">)</a> <a id="948" class="Symbol">=</a> <a id="950" href="StreamFun.html#942" class="Bound">f</a> <a id="952" class="Symbol">(</a><a id="953" href="StreamFun.html#553" class="Field">hd</a> <a id="956" href="StreamFun.html#944" class="Bound">as</a><a id="958" class="Symbol">)</a>
<a id="960" href="StreamFun.html#564" class="Field">tl</a> <a id="963" class="Symbol">(</a><a id="964" href="StreamFun.html#898" class="Function">map</a> <a id="968" href="StreamFun.html#968" class="Bound">f</a> <a id="970" href="StreamFun.html#970" class="Bound">as</a><a id="972" class="Symbol">)</a> <a id="974" class="Symbol">=</a> <a id="976" href="StreamFun.html#898" class="Function">map</a> <a id="980" href="StreamFun.html#968" class="Bound">f</a> <a id="982" class="Symbol">(</a><a id="983" href="StreamFun.html#564" class="Field">tl</a> <a id="986" href="StreamFun.html#970" class="Bound">as</a><a id="988" class="Symbol">)</a>

<a id="zip"></a><a id="991" href="StreamFun.html#991" class="Function">zip</a> <a id="995" class="Symbol">:</a> <a id="997" href="StreamFun.html#479" class="Record">Stream</a> <a id="1004" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1006" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1008" href="StreamFun.html#479" class="Record">Stream</a> <a id="1015" href="StreamFun.html#459" class="Generalizable">B</a> <a id="1017" class="Symbol">→</a> <a id="1019" href="StreamFun.html#479" class="Record">Stream</a> <a id="1026" class="Symbol">(</a><a id="1027" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1029" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1031" href="StreamFun.html#459" class="Generalizable">B</a><a id="1032" class="Symbol">)</a>
<a id="1034" href="StreamFun.html#553" class="Field">hd</a> <a id="1037" class="Symbol">(</a><a id="1038" href="StreamFun.html#991" class="Function">zip</a> <a id="1042" href="StreamFun.html#1042" class="Bound">uv</a><a id="1044" class="Symbol">)</a> <a id="1046" class="Symbol">=</a> <a id="1048" href="StreamFun.html#279" class="Function">map×</a> <a id="1053" href="StreamFun.html#553" class="Field">hd</a> <a id="1056" href="StreamFun.html#553" class="Field">hd</a> <a id="1059" href="StreamFun.html#1042" class="Bound">uv</a>
<a id="1062" href="StreamFun.html#564" class="Field">tl</a> <a id="1065" class="Symbol">(</a><a id="1066" href="StreamFun.html#991" class="Function">zip</a> <a id="1070" href="StreamFun.html#1070" class="Bound">uv</a><a id="1072" class="Symbol">)</a> <a id="1074" class="Symbol">=</a> <a id="1076" href="StreamFun.html#991" class="Function">zip</a> <a id="1080" class="Symbol">(</a><a id="1081" href="StreamFun.html#279" class="Function">map×</a> <a id="1086" href="StreamFun.html#564" class="Field">tl</a> <a id="1089" href="StreamFun.html#564" class="Field">tl</a> <a id="1092" href="StreamFun.html#1070" class="Bound">uv</a><a id="1094" class="Symbol">)</a>

<a id="1097" class="Comment">-- hd (zip (as , bs)) = hd as , hd bs</a>
<a id="1135" class="Comment">-- tl (zip (as , bs)) = zip (tl as , tl bs)</a>

<a id="1180" class="Comment">-- Seems a shame to make two passes, but I couldn&#39;t figure out how to satisfy</a>
<a id="1258" class="Comment">-- the termination checker in a single-pass definition.</a>
<a id="unzip"></a><a id="1314" href="StreamFun.html#1314" class="Function">unzip</a> <a id="1320" class="Symbol">:</a> <a id="1322" href="StreamFun.html#479" class="Record">Stream</a> <a id="1329" class="Symbol">(</a><a id="1330" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1332" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1334" href="StreamFun.html#459" class="Generalizable">B</a><a id="1335" class="Symbol">)</a> <a id="1337" class="Symbol">→</a> <a id="1339" href="StreamFun.html#479" class="Record">Stream</a> <a id="1346" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1348" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1350" href="StreamFun.html#479" class="Record">Stream</a> <a id="1357" href="StreamFun.html#459" class="Generalizable">B</a>
<a id="1359" href="StreamFun.html#1314" class="Function">unzip</a> <a id="1365" class="Symbol">=</a> <a id="1367" href="Data.Product.html#2313" class="Function Operator">&lt;</a> <a id="1369" href="StreamFun.html#898" class="Function">map</a> <a id="1373" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="1379" href="Data.Product.html#2313" class="Function Operator">,</a> <a id="1381" href="StreamFun.html#898" class="Function">map</a> <a id="1385" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="1391" href="Data.Product.html#2313" class="Function Operator">&gt;</a>
<a id="1393" class="Comment">-- unzip zs = map proj₁ zs , map proj₂ zs</a>

<a id="1436" class="Keyword">open</a> <a id="1441" class="Keyword">import</a> <a id="1448" href="Relation.Binary.html" class="Module">Relation.Binary</a> <a id="1464" class="Keyword">using</a> <a id="1470" class="Symbol">(</a><a id="1471" href="Relation.Binary.Core.html#882" class="Function">Rel</a><a id="1474" class="Symbol">)</a>
<a id="1476" class="Keyword">open</a> <a id="1481" class="Keyword">import</a> <a id="1488" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="1526" class="Keyword">hiding</a> <a id="1533" class="Symbol">(</a><a id="1534" href="Relation.Binary.PropositionalEquality.html#1471" class="Function Operator">_≗_</a><a id="1537" class="Symbol">)</a>

<a id="1540" class="Comment">-- Truncate to a vector</a>
<a id="take"></a><a id="1564" href="StreamFun.html#1564" class="Function">take</a> <a id="1569" class="Symbol">:</a> <a id="1571" class="Symbol">∀</a> <a id="1573" href="StreamFun.html#1573" class="Bound">n</a> <a id="1575" class="Symbol">→</a> <a id="1577" href="StreamFun.html#479" class="Record">Stream</a> <a id="1584" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1586" class="Symbol">→</a> <a id="1588" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1592" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1594" href="StreamFun.html#1573" class="Bound">n</a>
<a id="1596" href="StreamFun.html#1564" class="Function">take</a> <a id="1601" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a>    <a id="1609" href="StreamFun.html#1609" class="Bound">as</a> <a id="1612" class="Symbol">=</a> <a id="1614" href="Data.Vec.Base.html#995" class="InductiveConstructor">[]</a>
<a id="1617" href="StreamFun.html#1564" class="Function">take</a> <a id="1622" class="Symbol">(</a><a id="1623" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1627" href="StreamFun.html#1627" class="Bound">n</a><a id="1628" class="Symbol">)</a> <a id="1630" href="StreamFun.html#1630" class="Bound">as</a> <a id="1633" class="Symbol">=</a> <a id="1635" href="StreamFun.html#553" class="Field">hd</a> <a id="1638" href="StreamFun.html#1630" class="Bound">as</a> <a id="1641" href="Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="1643" href="StreamFun.html#1564" class="Function">take</a> <a id="1648" href="StreamFun.html#1627" class="Bound">n</a> <a id="1650" class="Symbol">(</a><a id="1651" href="StreamFun.html#564" class="Field">tl</a> <a id="1654" href="StreamFun.html#1630" class="Bound">as</a><a id="1656" class="Symbol">)</a>

<a id="1659" class="Keyword">infix</a> <a id="1665" class="Number">4</a> <a id="1667" href="StreamFun.html#1676" class="Function Operator">_≈_upto_</a>
<a id="_≈_upto_"></a><a id="1676" href="StreamFun.html#1676" class="Function Operator">_≈_upto_</a> <a id="1685" class="Symbol">:</a> <a id="1687" href="StreamFun.html#479" class="Record">Stream</a> <a id="1694" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1696" class="Symbol">→</a> <a id="1698" href="StreamFun.html#479" class="Record">Stream</a> <a id="1705" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1707" class="Symbol">→</a> <a id="1709" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1711" class="Symbol">→</a> <a id="1713" class="PrimitiveType">Set</a>
<a id="1717" href="StreamFun.html#1717" class="Bound">u</a> <a id="1719" href="StreamFun.html#1676" class="Function Operator">≈</a> <a id="1721" href="StreamFun.html#1721" class="Bound">v</a> <a id="1723" href="StreamFun.html#1676" class="Function Operator">upto</a> <a id="1728" href="StreamFun.html#1728" class="Bound">n</a> <a id="1730" class="Symbol">=</a> <a id="1732" href="StreamFun.html#1564" class="Function">take</a> <a id="1737" href="StreamFun.html#1728" class="Bound">n</a> <a id="1739" href="StreamFun.html#1717" class="Bound">u</a> <a id="1741" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1743" href="StreamFun.html#1564" class="Function">take</a> <a id="1748" href="StreamFun.html#1728" class="Bound">n</a> <a id="1750" href="StreamFun.html#1721" class="Bound">v</a>

<a id="1753" class="Keyword">infix</a> <a id="1759" class="Number">1</a> <a id="1761" href="StreamFun.html#1765" class="Function Operator">_↠_</a>
<a id="_↠_"></a><a id="1765" href="StreamFun.html#1765" class="Function Operator">_↠_</a> <a id="1769" class="Symbol">:</a> <a id="1771" class="PrimitiveType">Set</a> <a id="1775" class="Symbol">→</a> <a id="1777" class="PrimitiveType">Set</a> <a id="1781" class="Symbol">→</a> <a id="1783" class="PrimitiveType">Set</a>
<a id="1787" href="StreamFun.html#1787" class="Bound">A</a> <a id="1789" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="1791" href="StreamFun.html#1791" class="Bound">B</a> <a id="1793" class="Symbol">=</a> <a id="1795" href="StreamFun.html#479" class="Record">Stream</a> <a id="1802" href="StreamFun.html#1787" class="Bound">A</a> <a id="1804" class="Symbol">→</a> <a id="1806" href="StreamFun.html#479" class="Record">Stream</a> <a id="1813" href="StreamFun.html#1791" class="Bound">B</a>

<a id="1816" class="Keyword">infix</a> <a id="1822" class="Number">4</a> <a id="1824" href="StreamFun.html#1828" class="Function Operator">_≗_</a>
<a id="_≗_"></a><a id="1828" href="StreamFun.html#1828" class="Function Operator">_≗_</a> <a id="1832" class="Symbol">:</a> <a id="1834" href="Relation.Binary.Core.html#882" class="Function">Rel</a> <a id="1838" class="Symbol">(</a><a id="1839" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1841" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="1843" href="StreamFun.html#459" class="Generalizable">B</a><a id="1844" class="Symbol">)</a> <a id="1846" class="Symbol">_</a>
<a id="1848" href="StreamFun.html#1848" class="Bound">f</a> <a id="1850" href="StreamFun.html#1828" class="Function Operator">≗</a> <a id="1852" href="StreamFun.html#1852" class="Bound">g</a> <a id="1854" class="Symbol">=</a> <a id="1856" class="Symbol">∀</a> <a id="1858" href="StreamFun.html#1858" class="Bound">as</a> <a id="1861" class="Symbol">→</a> <a id="1863" href="StreamFun.html#1848" class="Bound">f</a> <a id="1865" href="StreamFun.html#1858" class="Bound">as</a> <a id="1868" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="1870" href="StreamFun.html#1852" class="Bound">g</a> <a id="1872" href="StreamFun.html#1858" class="Bound">as</a>

<a id="causal"></a><a id="1876" href="StreamFun.html#1876" class="Function">causal</a> <a id="1883" class="Symbol">:</a> <a id="1885" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1887" class="Symbol">→</a> <a id="1889" class="Symbol">(</a><a id="1890" href="StreamFun.html#457" class="Generalizable">A</a> <a id="1892" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="1894" href="StreamFun.html#459" class="Generalizable">B</a><a id="1895" class="Symbol">)</a> <a id="1897" class="Symbol">→</a> <a id="1899" class="PrimitiveType">Set</a>
<a id="1903" href="StreamFun.html#1876" class="Function">causal</a> <a id="1910" href="StreamFun.html#1910" class="Bound">d</a> <a id="1912" href="StreamFun.html#1912" class="Bound">f</a> <a id="1914" class="Symbol">=</a> <a id="1916" class="Symbol">∀</a> <a id="1918" href="StreamFun.html#1918" class="Bound">n</a> <a id="1920" href="StreamFun.html#1920" class="Bound">u</a> <a id="1922" href="StreamFun.html#1922" class="Bound">v</a> <a id="1924" class="Symbol">→</a> <a id="1926" href="StreamFun.html#1920" class="Bound">u</a> <a id="1928" href="StreamFun.html#1676" class="Function Operator">≈</a> <a id="1930" href="StreamFun.html#1922" class="Bound">v</a> <a id="1932" href="StreamFun.html#1676" class="Function Operator">upto</a> <a id="1937" href="StreamFun.html#1918" class="Bound">n</a> <a id="1939" class="Symbol">→</a> <a id="1941" href="StreamFun.html#1912" class="Bound">f</a> <a id="1943" href="StreamFun.html#1920" class="Bound">u</a> <a id="1945" href="StreamFun.html#1676" class="Function Operator">≈</a> <a id="1947" href="StreamFun.html#1912" class="Bound">f</a> <a id="1949" href="StreamFun.html#1922" class="Bound">v</a> <a id="1951" href="StreamFun.html#1676" class="Function Operator">upto</a> <a id="1956" class="Symbol">(</a><a id="1957" href="StreamFun.html#1910" class="Bound">d</a> <a id="1959" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="1961" href="StreamFun.html#1918" class="Bound">n</a><a id="1962" class="Symbol">)</a>

<a id="1965" class="Comment">-- TODO: Define a category of causal stream functions. Then map Mealy to them.</a>

<a id="2045" class="Comment">-- Mapping a function (combinational logic)</a>
<a id="arr"></a><a id="2089" href="StreamFun.html#2089" class="Function">arr</a> <a id="2093" class="Symbol">:</a> <a id="2095" class="Symbol">(</a><a id="2096" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2098" class="Symbol">→</a> <a id="2100" href="StreamFun.html#459" class="Generalizable">B</a><a id="2101" class="Symbol">)</a> <a id="2103" class="Symbol">→</a> <a id="2105" class="Symbol">(</a><a id="2106" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2108" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2110" href="StreamFun.html#459" class="Generalizable">B</a><a id="2111" class="Symbol">)</a>
<a id="2113" href="StreamFun.html#2089" class="Function">arr</a> <a id="2117" class="Symbol">=</a> <a id="2119" href="StreamFun.html#898" class="Function">map</a>

<a id="const"></a><a id="2124" href="StreamFun.html#2124" class="Function">const</a> <a id="2130" class="Symbol">:</a> <a id="2132" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2134" class="Symbol">→</a> <a id="2136" href="StreamFun.html#479" class="Record">Stream</a> <a id="2143" href="StreamFun.html#457" class="Generalizable">A</a>
<a id="2145" href="StreamFun.html#553" class="Field">hd</a> <a id="2148" class="Symbol">(</a><a id="2149" href="StreamFun.html#2124" class="Function">const</a> <a id="2155" href="StreamFun.html#2155" class="Bound">a</a><a id="2156" class="Symbol">)</a> <a id="2158" class="Symbol">=</a> <a id="2160" href="StreamFun.html#2155" class="Bound">a</a>
<a id="2162" href="StreamFun.html#564" class="Field">tl</a> <a id="2165" class="Symbol">(</a><a id="2166" href="StreamFun.html#2124" class="Function">const</a> <a id="2172" href="StreamFun.html#2172" class="Bound">a</a><a id="2173" class="Symbol">)</a> <a id="2175" class="Symbol">=</a> <a id="2177" href="StreamFun.html#2124" class="Function">const</a> <a id="2183" href="StreamFun.html#2172" class="Bound">a</a>

<a id="id"></a><a id="2186" href="StreamFun.html#2186" class="Function">id</a> <a id="2189" class="Symbol">:</a> <a id="2191" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2193" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2195" href="StreamFun.html#457" class="Generalizable">A</a>
<a id="2197" href="StreamFun.html#2186" class="Function">id</a> <a id="2200" class="Symbol">=</a> <a id="2202" href="StreamFun.html#219" class="Function">id→</a>

<a id="2207" class="Keyword">infixr</a> <a id="2214" class="Number">9</a> <a id="2216" href="StreamFun.html#2220" class="Function Operator">_∘_</a>
<a id="_∘_"></a><a id="2220" href="StreamFun.html#2220" class="Function Operator">_∘_</a> <a id="2224" class="Symbol">:</a> <a id="2226" class="Symbol">(</a><a id="2227" href="StreamFun.html#459" class="Generalizable">B</a> <a id="2229" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2231" href="StreamFun.html#461" class="Generalizable">C</a><a id="2232" class="Symbol">)</a> <a id="2234" class="Symbol">→</a> <a id="2236" class="Symbol">(</a><a id="2237" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2239" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2241" href="StreamFun.html#459" class="Generalizable">B</a><a id="2242" class="Symbol">)</a> <a id="2244" class="Symbol">→</a> <a id="2246" class="Symbol">(</a><a id="2247" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2249" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2251" href="StreamFun.html#461" class="Generalizable">C</a><a id="2252" class="Symbol">)</a>
<a id="2254" href="StreamFun.html#2220" class="Function Operator">_∘_</a> <a id="2258" class="Symbol">=</a> <a id="2260" href="Function.Base.html#3706" class="Function Operator">_∘′_</a>

<a id="2266" class="Comment">-- Parallel composition</a>
<a id="2290" class="Keyword">infixr</a> <a id="2297" class="Number">10</a> <a id="2300" href="StreamFun.html#2304" class="Function Operator">_⊗_</a>
<a id="_⊗_"></a><a id="2304" href="StreamFun.html#2304" class="Function Operator">_⊗_</a> <a id="2308" class="Symbol">:</a> <a id="2310" class="Symbol">(</a><a id="2311" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2313" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2315" href="StreamFun.html#461" class="Generalizable">C</a><a id="2316" class="Symbol">)</a> <a id="2318" class="Symbol">→</a> <a id="2320" class="Symbol">(</a><a id="2321" href="StreamFun.html#459" class="Generalizable">B</a> <a id="2323" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2325" href="StreamFun.html#463" class="Generalizable">D</a><a id="2326" class="Symbol">)</a> <a id="2328" class="Symbol">→</a> <a id="2330" class="Symbol">(</a><a id="2331" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2333" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2335" href="StreamFun.html#459" class="Generalizable">B</a> <a id="2337" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2339" href="StreamFun.html#461" class="Generalizable">C</a> <a id="2341" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2343" href="StreamFun.html#463" class="Generalizable">D</a><a id="2344" class="Symbol">)</a>
<a id="2346" href="StreamFun.html#2346" class="Bound">f</a> <a id="2348" href="StreamFun.html#2304" class="Function Operator">⊗</a> <a id="2350" href="StreamFun.html#2350" class="Bound">g</a> <a id="2352" class="Symbol">=</a> <a id="2354" href="StreamFun.html#991" class="Function">zip</a> <a id="2358" href="Function.Base.html#3706" class="Function Operator">∘′</a> <a id="2361" href="StreamFun.html#279" class="Function">map×</a> <a id="2366" href="StreamFun.html#2346" class="Bound">f</a> <a id="2368" href="StreamFun.html#2350" class="Bound">g</a> <a id="2370" href="Function.Base.html#3706" class="Function Operator">∘′</a> <a id="2373" href="StreamFun.html#1314" class="Function">unzip</a>
<a id="2379" class="Comment">-- (f ⊗ g) ps = let as , bs = unzip ps in zip (f as) (g bs)</a>

<a id="2440" class="Comment">-- -- -- Conditional/choice composition</a>
<a id="2480" class="Comment">-- -- infixr 6 _⊕_</a>
<a id="2499" class="Comment">-- -- _⊕_ : (A ↠ C) → (B ↠ D) → ((A ⊎ B) ↠ (C ⊎ D))</a>

<a id="2552" class="Comment">-- Cons (memory/register)</a>
<a id="delay"></a><a id="2578" href="StreamFun.html#2578" class="Function">delay</a> <a id="2584" class="Symbol">:</a> <a id="2586" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2588" class="Symbol">→</a> <a id="2590" class="Symbol">(</a><a id="2591" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2593" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2595" href="StreamFun.html#457" class="Generalizable">A</a><a id="2596" class="Symbol">)</a>
<a id="2598" href="StreamFun.html#553" class="Field">hd</a> <a id="2601" class="Symbol">(</a><a id="2602" href="StreamFun.html#2578" class="Function">delay</a> <a id="2608" href="StreamFun.html#2608" class="Bound">a</a> <a id="2610" href="StreamFun.html#2610" class="Bound">as</a><a id="2612" class="Symbol">)</a> <a id="2614" class="Symbol">=</a> <a id="2616" href="StreamFun.html#2608" class="Bound">a</a>
<a id="2618" href="StreamFun.html#564" class="Field">tl</a> <a id="2621" class="Symbol">(</a><a id="2622" href="StreamFun.html#2578" class="Function">delay</a> <a id="2628" href="StreamFun.html#2628" class="Bound">a</a> <a id="2630" href="StreamFun.html#2630" class="Bound">as</a><a id="2632" class="Symbol">)</a> <a id="2634" class="Symbol">=</a> <a id="2636" href="StreamFun.html#2630" class="Bound">as</a>

<a id="scanl"></a><a id="2640" href="StreamFun.html#2640" class="Function">scanl</a> <a id="2646" class="Symbol">:</a> <a id="2648" class="Symbol">(</a><a id="2649" href="StreamFun.html#459" class="Generalizable">B</a> <a id="2651" class="Symbol">→</a> <a id="2653" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2655" class="Symbol">→</a> <a id="2657" href="StreamFun.html#459" class="Generalizable">B</a><a id="2658" class="Symbol">)</a> <a id="2660" class="Symbol">→</a> <a id="2662" href="StreamFun.html#459" class="Generalizable">B</a> <a id="2664" class="Symbol">→</a> <a id="2666" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2668" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2670" href="StreamFun.html#459" class="Generalizable">B</a>
<a id="2672" href="StreamFun.html#553" class="Field">hd</a> <a id="2675" class="Symbol">(</a><a id="2676" href="StreamFun.html#2640" class="Function">scanl</a> <a id="2682" href="StreamFun.html#2682" class="Bound">f</a> <a id="2684" href="StreamFun.html#2684" class="Bound">e</a> <a id="2686" href="StreamFun.html#2686" class="Bound">as</a><a id="2688" class="Symbol">)</a> <a id="2690" class="Symbol">=</a> <a id="2692" href="StreamFun.html#2684" class="Bound">e</a>
<a id="2694" href="StreamFun.html#564" class="Field">tl</a> <a id="2697" class="Symbol">(</a><a id="2698" href="StreamFun.html#2640" class="Function">scanl</a> <a id="2704" href="StreamFun.html#2704" class="Bound">f</a> <a id="2706" href="StreamFun.html#2706" class="Bound">e</a> <a id="2708" href="StreamFun.html#2708" class="Bound">as</a><a id="2710" class="Symbol">)</a> <a id="2712" class="Symbol">=</a> <a id="2714" href="StreamFun.html#2640" class="Function">scanl</a> <a id="2720" href="StreamFun.html#2704" class="Bound">f</a> <a id="2722" class="Symbol">(</a><a id="2723" href="StreamFun.html#2704" class="Bound">f</a> <a id="2725" href="StreamFun.html#2706" class="Bound">e</a> <a id="2727" class="Symbol">(</a><a id="2728" href="StreamFun.html#553" class="Field">hd</a> <a id="2731" href="StreamFun.html#2708" class="Bound">as</a><a id="2733" class="Symbol">))</a> <a id="2736" class="Symbol">(</a><a id="2737" href="StreamFun.html#564" class="Field">tl</a> <a id="2740" href="StreamFun.html#2708" class="Bound">as</a><a id="2742" class="Symbol">)</a>

<a id="mealy"></a><a id="2745" href="StreamFun.html#2745" class="Function">mealy</a> <a id="2751" class="Symbol">:</a> <a id="2753" class="Symbol">∀</a> <a id="2755" class="Symbol">{</a><a id="2756" href="StreamFun.html#2756" class="Bound">σ</a> <a id="2758" class="Symbol">:</a> <a id="2760" class="PrimitiveType">Set</a><a id="2763" class="Symbol">}</a> <a id="2765" class="Symbol">→</a> <a id="2767" href="StreamFun.html#2756" class="Bound">σ</a> <a id="2769" class="Symbol">→</a> <a id="2771" class="Symbol">(</a><a id="2772" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2774" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2776" href="StreamFun.html#2756" class="Bound">σ</a> <a id="2778" class="Symbol">→</a> <a id="2780" href="StreamFun.html#459" class="Generalizable">B</a> <a id="2782" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2784" href="StreamFun.html#2756" class="Bound">σ</a><a id="2785" class="Symbol">)</a> <a id="2787" class="Symbol">→</a> <a id="2789" href="StreamFun.html#457" class="Generalizable">A</a> <a id="2791" href="StreamFun.html#1765" class="Function Operator">↠</a> <a id="2793" href="StreamFun.html#459" class="Generalizable">B</a>
<a id="2795" href="StreamFun.html#553" class="Field">hd</a> <a id="2798" class="Symbol">(</a><a id="2799" href="StreamFun.html#2745" class="Function">mealy</a> <a id="2805" href="StreamFun.html#2805" class="Bound">s</a> <a id="2807" href="StreamFun.html#2807" class="Bound">f</a> <a id="2809" href="StreamFun.html#2809" class="Bound">as</a><a id="2811" class="Symbol">)</a> <a id="2813" class="Symbol">=</a> <a id="2815" class="Keyword">let</a> <a id="2819" href="StreamFun.html#2819" class="Bound">b</a> <a id="2821" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2823" class="Symbol">_</a>  <a id="2826" class="Symbol">=</a> <a id="2828" href="StreamFun.html#2807" class="Bound">f</a> <a id="2830" class="Symbol">(</a><a id="2831" href="StreamFun.html#553" class="Field">hd</a> <a id="2834" href="StreamFun.html#2809" class="Bound">as</a> <a id="2837" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2839" href="StreamFun.html#2805" class="Bound">s</a><a id="2840" class="Symbol">)</a> <a id="2842" class="Keyword">in</a> <a id="2845" href="StreamFun.html#2819" class="Bound">b</a>
<a id="2847" href="StreamFun.html#564" class="Field">tl</a> <a id="2850" class="Symbol">(</a><a id="2851" href="StreamFun.html#2745" class="Function">mealy</a> <a id="2857" href="StreamFun.html#2857" class="Bound">s</a> <a id="2859" href="StreamFun.html#2859" class="Bound">f</a> <a id="2861" href="StreamFun.html#2861" class="Bound">as</a><a id="2863" class="Symbol">)</a> <a id="2865" class="Symbol">=</a> <a id="2867" class="Keyword">let</a> <a id="2871" class="Symbol">_</a> <a id="2873" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2875" href="StreamFun.html#2875" class="Bound">s′</a> <a id="2878" class="Symbol">=</a> <a id="2880" href="StreamFun.html#2859" class="Bound">f</a> <a id="2882" class="Symbol">(</a><a id="2883" href="StreamFun.html#553" class="Field">hd</a> <a id="2886" href="StreamFun.html#2861" class="Bound">as</a> <a id="2889" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2891" href="StreamFun.html#2857" class="Bound">s</a><a id="2892" class="Symbol">)</a> <a id="2894" class="Keyword">in</a> <a id="2897" href="StreamFun.html#2745" class="Function">mealy</a> <a id="2903" href="StreamFun.html#2875" class="Bound">s′</a> <a id="2906" href="StreamFun.html#2859" class="Bound">f</a> <a id="2908" class="Symbol">(</a><a id="2909" href="StreamFun.html#564" class="Field">tl</a> <a id="2912" href="StreamFun.html#2861" class="Bound">as</a><a id="2914" class="Symbol">)</a>

<a id="2917" class="Comment">-- -- Can mealy be defined without redundant computation?</a>
<a id="2975" class="Comment">-- -- The following alternative doesn&#39;t pass termination checking:</a>
<a id="3042" class="Comment">-- mealy s f as = let b , s′ = f (hd as , s) in b ∷′ mealy s′ f (tl as)</a>

<a id="3115" class="Comment">-- TODO: relate scanl and mealy. Are they inter-definable?</a>

<a id="3175" class="Comment">-------------------------------------------------------------------------------</a>
<a id="3255" class="Comment">-- Properties</a>
<a id="3269" class="Comment">-------------------------------------------------------------------------------</a>

<a id="3350" class="Keyword">open</a> <a id="3355" class="Keyword">import</a> <a id="3362" href="Relation.Binary.PropositionalEquality.Properties.html" class="Module">Relation.Binary.PropositionalEquality.Properties</a>

<a id="3412" class="Comment">-- open import Relation.Binary.Structures ()</a>

<a id="3458" class="Comment">-- open IsEquivalence isEquivalence renaming (refl to refl≡; sym to sym≡; trans to trans≡)</a>

<a id="3550" class="Comment">-- open ≡-Reasoning</a>

<a id="≈-refl"></a><a id="3571" href="StreamFun.html#3571" class="Function">≈-refl</a> <a id="3578" class="Symbol">:</a> <a id="3580" class="Symbol">∀</a> <a id="3582" class="Symbol">{</a><a id="3583" href="StreamFun.html#3583" class="Bound">as</a> <a id="3586" class="Symbol">:</a> <a id="3588" href="StreamFun.html#479" class="Record">Stream</a> <a id="3595" href="StreamFun.html#457" class="Generalizable">A</a><a id="3596" class="Symbol">}</a> <a id="3598" class="Symbol">→</a> <a id="3600" href="StreamFun.html#3583" class="Bound">as</a> <a id="3603" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="3605" href="StreamFun.html#3583" class="Bound">as</a>
<a id="3608" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="3613" href="StreamFun.html#3571" class="Function">≈-refl</a> <a id="3620" class="Symbol">=</a> <a id="3622" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="3627" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="3632" href="StreamFun.html#3571" class="Function">≈-refl</a> <a id="3639" class="Symbol">=</a> <a id="3641" href="StreamFun.html#3571" class="Function">≈-refl</a>

<a id="≈-sym"></a><a id="3649" href="StreamFun.html#3649" class="Function">≈-sym</a> <a id="3655" class="Symbol">:</a> <a id="3657" class="Symbol">∀</a> <a id="3659" class="Symbol">{</a><a id="3660" href="StreamFun.html#3660" class="Bound">u</a> <a id="3662" href="StreamFun.html#3662" class="Bound">v</a> <a id="3664" class="Symbol">:</a> <a id="3666" href="StreamFun.html#479" class="Record">Stream</a> <a id="3673" href="StreamFun.html#457" class="Generalizable">A</a><a id="3674" class="Symbol">}</a> <a id="3676" class="Symbol">→</a> <a id="3678" href="StreamFun.html#3660" class="Bound">u</a> <a id="3680" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="3682" href="StreamFun.html#3662" class="Bound">v</a> <a id="3684" class="Symbol">→</a> <a id="3686" href="StreamFun.html#3662" class="Bound">v</a> <a id="3688" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="3690" href="StreamFun.html#3660" class="Bound">u</a>
<a id="3692" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="3697" class="Symbol">(</a><a id="3698" href="StreamFun.html#3649" class="Function">≈-sym</a> <a id="3704" href="StreamFun.html#3704" class="Bound">u≈v</a><a id="3707" class="Symbol">)</a> <a id="3709" class="Symbol">=</a>   <a id="3713" href="Relation.Binary.PropositionalEquality.Core.html#1727" class="Function">sym</a> <a id="3717" class="Symbol">(</a><a id="3718" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="3723" href="StreamFun.html#3704" class="Bound">u≈v</a><a id="3726" class="Symbol">)</a>
<a id="3728" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="3733" class="Symbol">(</a><a id="3734" href="StreamFun.html#3649" class="Function">≈-sym</a> <a id="3740" href="StreamFun.html#3740" class="Bound">u≈v</a><a id="3743" class="Symbol">)</a> <a id="3745" class="Symbol">=</a> <a id="3747" href="StreamFun.html#3649" class="Function">≈-sym</a> <a id="3753" class="Symbol">(</a><a id="3754" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="3759" href="StreamFun.html#3740" class="Bound">u≈v</a><a id="3762" class="Symbol">)</a>

<a id="≈-trans"></a><a id="3765" href="StreamFun.html#3765" class="Function">≈-trans</a> <a id="3773" class="Symbol">:</a> <a id="3775" class="Symbol">∀</a> <a id="3777" class="Symbol">{</a><a id="3778" href="StreamFun.html#3778" class="Bound">u</a> <a id="3780" href="StreamFun.html#3780" class="Bound">v</a> <a id="3782" href="StreamFun.html#3782" class="Bound">w</a> <a id="3784" class="Symbol">:</a> <a id="3786" href="StreamFun.html#479" class="Record">Stream</a> <a id="3793" href="StreamFun.html#457" class="Generalizable">A</a><a id="3794" class="Symbol">}</a> <a id="3796" class="Symbol">→</a> <a id="3798" href="StreamFun.html#3778" class="Bound">u</a> <a id="3800" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="3802" href="StreamFun.html#3780" class="Bound">v</a> <a id="3804" class="Symbol">→</a> <a id="3806" href="StreamFun.html#3780" class="Bound">v</a> <a id="3808" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="3810" href="StreamFun.html#3782" class="Bound">w</a> <a id="3812" class="Symbol">→</a> <a id="3814" href="StreamFun.html#3778" class="Bound">u</a> <a id="3816" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="3818" href="StreamFun.html#3782" class="Bound">w</a>
<a id="3820" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="3825" class="Symbol">(</a><a id="3826" href="StreamFun.html#3765" class="Function">≈-trans</a> <a id="3834" href="StreamFun.html#3834" class="Bound">u≈v</a> <a id="3838" href="StreamFun.html#3838" class="Bound">v≈w</a><a id="3841" class="Symbol">)</a> <a id="3843" class="Symbol">=</a>   <a id="3847" href="Relation.Binary.PropositionalEquality.Core.html#1772" class="Function">trans</a> <a id="3853" class="Symbol">(</a><a id="3854" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="3859" href="StreamFun.html#3834" class="Bound">u≈v</a><a id="3862" class="Symbol">)</a> <a id="3864" class="Symbol">(</a><a id="3865" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="3870" href="StreamFun.html#3838" class="Bound">v≈w</a><a id="3873" class="Symbol">)</a>
<a id="3875" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="3880" class="Symbol">(</a><a id="3881" href="StreamFun.html#3765" class="Function">≈-trans</a> <a id="3889" href="StreamFun.html#3889" class="Bound">u≈v</a> <a id="3893" href="StreamFun.html#3893" class="Bound">v≈w</a><a id="3896" class="Symbol">)</a> <a id="3898" class="Symbol">=</a> <a id="3900" href="StreamFun.html#3765" class="Function">≈-trans</a> <a id="3908" class="Symbol">(</a><a id="3909" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="3914" href="StreamFun.html#3889" class="Bound">u≈v</a><a id="3917" class="Symbol">)</a> <a id="3919" class="Symbol">(</a><a id="3920" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="3925" href="StreamFun.html#3893" class="Bound">v≈w</a><a id="3928" class="Symbol">)</a>

<a id="3931" class="Keyword">open</a> <a id="3936" class="Keyword">import</a> <a id="3943" href="Relation.Binary.html" class="Module">Relation.Binary</a>

<a id="isEq"></a><a id="3960" href="StreamFun.html#3960" class="Function">isEq</a> <a id="3965" class="Symbol">:</a> <a id="3967" href="Relation.Binary.Structures.html#1522" class="Record">IsEquivalence</a> <a id="3981" class="Symbol">{</a><a id="3982" class="Argument">A</a> <a id="3984" class="Symbol">=</a> <a id="3986" href="StreamFun.html#479" class="Record">Stream</a> <a id="3993" href="StreamFun.html#457" class="Generalizable">A</a><a id="3994" class="Symbol">}</a> <a id="3996" href="StreamFun.html#618" class="Record Operator">_≈_</a>
<a id="4000" href="StreamFun.html#3960" class="Function">isEq</a> <a id="4005" class="Symbol">=</a> <a id="4007" class="Keyword">record</a> <a id="4014" class="Symbol">{</a> <a id="4016" href="Relation.Binary.Structures.html#1568" class="Field">refl</a> <a id="4021" class="Symbol">=</a> <a id="4023" href="StreamFun.html#3571" class="Function">≈-refl</a> <a id="4030" class="Symbol">;</a> <a id="4032" href="Relation.Binary.Structures.html#1594" class="Field">sym</a> <a id="4036" class="Symbol">=</a> <a id="4038" href="StreamFun.html#3649" class="Function">≈-sym</a> <a id="4044" class="Symbol">;</a> <a id="4046" href="Relation.Binary.Structures.html#1620" class="Field">trans</a> <a id="4052" class="Symbol">=</a> <a id="4054" href="StreamFun.html#3765" class="Function">≈-trans</a> <a id="4062" class="Symbol">}</a>

<a id="≈-setoid"></a><a id="4065" href="StreamFun.html#4065" class="Function">≈-setoid</a> <a id="4074" class="Symbol">:</a> <a id="4076" class="PrimitiveType">Set</a> <a id="4080" class="Symbol">→</a> <a id="4082" href="Relation.Binary.Bundles.html#1009" class="Record">Setoid</a> <a id="4089" class="Symbol">_</a> <a id="4091" class="Symbol">_</a>
<a id="4093" href="StreamFun.html#4065" class="Function">≈-setoid</a> <a id="4102" href="StreamFun.html#4102" class="Bound">A</a> <a id="4104" class="Symbol">=</a> <a id="4106" class="Keyword">record</a> <a id="4113" class="Symbol">{</a> <a id="4115" href="Relation.Binary.Bundles.html#1072" class="Field">Carrier</a> <a id="4123" class="Symbol">=</a> <a id="4125" href="StreamFun.html#479" class="Record">Stream</a> <a id="4132" href="StreamFun.html#4102" class="Bound">A</a> <a id="4134" class="Symbol">;</a> <a id="4136" href="Relation.Binary.Bundles.html#1098" class="Field Operator">_≈_</a> <a id="4140" class="Symbol">=</a> <a id="4142" href="StreamFun.html#618" class="Record Operator">_≈_</a> <a id="4146" class="Symbol">;</a> <a id="4148" href="Relation.Binary.Bundles.html#1132" class="Field">isEquivalence</a> <a id="4162" class="Symbol">=</a> <a id="4164" href="StreamFun.html#3960" class="Function">isEq</a> <a id="4169" class="Symbol">}</a>

<a id="4172" class="Keyword">module</a> <a id="R"></a><a id="4179" href="StreamFun.html#4179" class="Module">R</a> <a id="4181" class="Symbol">{</a><a id="4182" href="StreamFun.html#4182" class="Bound">A</a> <a id="4184" class="Symbol">:</a> <a id="4186" class="PrimitiveType">Set</a><a id="4189" class="Symbol">}</a> <a id="4191" class="Keyword">where</a>
  <a id="4199" class="Keyword">open</a> <a id="4204" class="Keyword">import</a> <a id="4211" href="Relation.Binary.Reasoning.Setoid.html" class="Module">Relation.Binary.Reasoning.Setoid</a> <a id="4244" class="Symbol">(</a><a id="4245" href="StreamFun.html#4065" class="Function">≈-setoid</a> <a id="4254" href="StreamFun.html#4182" class="Bound">A</a><a id="4255" class="Symbol">)</a> <a id="4257" class="Keyword">public</a>

<a id="4265" class="Comment">-- open R</a>

<a id="zip∘unzip"></a><a id="4276" href="StreamFun.html#4276" class="Function">zip∘unzip</a> <a id="4286" class="Symbol">:</a> <a id="4288" class="Symbol">∀</a> <a id="4290" class="Symbol">{</a><a id="4291" href="StreamFun.html#4291" class="Bound">ps</a> <a id="4294" class="Symbol">:</a> <a id="4296" href="StreamFun.html#479" class="Record">Stream</a> <a id="4303" class="Symbol">(</a><a id="4304" href="StreamFun.html#457" class="Generalizable">A</a> <a id="4306" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4308" href="StreamFun.html#459" class="Generalizable">B</a><a id="4309" class="Symbol">)}</a> <a id="4312" class="Symbol">→</a> <a id="4314" href="StreamFun.html#991" class="Function">zip</a> <a id="4318" class="Symbol">(</a><a id="4319" href="StreamFun.html#1314" class="Function">unzip</a> <a id="4325" href="StreamFun.html#4291" class="Bound">ps</a><a id="4327" class="Symbol">)</a> <a id="4329" href="StreamFun.html#618" class="Record Operator">≈</a> <a id="4331" href="StreamFun.html#4291" class="Bound">ps</a>
<a id="4334" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="4339" href="StreamFun.html#4276" class="Function">zip∘unzip</a> <a id="4349" class="Symbol">=</a> <a id="4351" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="4356" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="4361" href="StreamFun.html#4276" class="Function">zip∘unzip</a> <a id="4371" class="Symbol">=</a> <a id="4373" href="StreamFun.html#4276" class="Function">zip∘unzip</a>  <a id="4384" class="Comment">-- on tl ps</a>

<a id="zip∘unzip′"></a><a id="4397" href="StreamFun.html#4397" class="Function">zip∘unzip′</a> <a id="4408" class="Symbol">:</a> <a id="4410" href="StreamFun.html#991" class="Function">zip</a> <a id="4414" href="Function.Base.html#3706" class="Function Operator">∘′</a> <a id="4417" href="StreamFun.html#1314" class="Function">unzip</a> <a id="4423" href="StreamFun.html#1828" class="Function Operator">≗</a> <a id="4425" href="StreamFun.html#2186" class="Function">id</a> <a id="4428" class="Symbol">{</a><a id="4429" href="StreamFun.html#457" class="Generalizable">A</a> <a id="4431" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4433" href="StreamFun.html#459" class="Generalizable">B</a><a id="4434" class="Symbol">}</a>
<a id="4436" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="4441" class="Symbol">(</a><a id="4442" href="StreamFun.html#4397" class="Function">zip∘unzip′</a> <a id="4453" class="Symbol">_)</a> <a id="4456" class="Symbol">=</a> <a id="4458" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="4463" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="4468" class="Symbol">(</a><a id="4469" href="StreamFun.html#4397" class="Function">zip∘unzip′</a> <a id="4480" href="StreamFun.html#4480" class="Bound">ps</a><a id="4482" class="Symbol">)</a> <a id="4484" class="Symbol">=</a> <a id="4486" href="StreamFun.html#4397" class="Function">zip∘unzip′</a> <a id="4497" class="Symbol">(</a><a id="4498" href="StreamFun.html#564" class="Field">tl</a> <a id="4501" href="StreamFun.html#4480" class="Bound">ps</a><a id="4503" class="Symbol">)</a>  <a id="4506" class="Comment">-- on tl ps</a>

<a id="4519" class="Comment">-- delay⊗ : ∀ {a₀ : A} {b₀ : B} ps → (delay a₀ ⊗ delay b₀) ps ≈ delay (a₀ , b₀) ps</a>
<a id="delay⊗"></a><a id="4602" href="StreamFun.html#4602" class="Function">delay⊗</a> <a id="4609" class="Symbol">:</a> <a id="4611" class="Symbol">∀</a> <a id="4613" class="Symbol">{</a><a id="4614" href="StreamFun.html#4614" class="Bound">a₀</a> <a id="4617" class="Symbol">:</a> <a id="4619" href="StreamFun.html#457" class="Generalizable">A</a><a id="4620" class="Symbol">}</a> <a id="4622" class="Symbol">{</a><a id="4623" href="StreamFun.html#4623" class="Bound">b₀</a> <a id="4626" class="Symbol">:</a> <a id="4628" href="StreamFun.html#459" class="Generalizable">B</a><a id="4629" class="Symbol">}</a> <a id="4631" class="Symbol">→</a> <a id="4633" href="StreamFun.html#2578" class="Function">delay</a> <a id="4639" href="StreamFun.html#4614" class="Bound">a₀</a> <a id="4642" href="StreamFun.html#2304" class="Function Operator">⊗</a> <a id="4644" href="StreamFun.html#2578" class="Function">delay</a> <a id="4650" href="StreamFun.html#4623" class="Bound">b₀</a> <a id="4653" href="StreamFun.html#1828" class="Function Operator">≗</a> <a id="4655" href="StreamFun.html#2578" class="Function">delay</a> <a id="4661" class="Symbol">(</a><a id="4662" href="StreamFun.html#4614" class="Bound">a₀</a> <a id="4665" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4667" href="StreamFun.html#4623" class="Bound">b₀</a><a id="4669" class="Symbol">)</a>
<a id="4671" href="StreamFun.html#712" class="Field">hd-≈</a> <a id="4676" class="Symbol">(</a><a id="4677" href="StreamFun.html#4602" class="Function">delay⊗</a> <a id="4684" href="StreamFun.html#4684" class="Bound">ps</a><a id="4686" class="Symbol">)</a> <a id="4688" class="Symbol">=</a> <a id="4690" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="4695" href="StreamFun.html#737" class="Field">tl-≈</a> <a id="4700" class="Symbol">(</a><a id="4701" href="StreamFun.html#4602" class="Function">delay⊗</a> <a id="4708" href="StreamFun.html#4708" class="Bound">ps</a><a id="4710" class="Symbol">)</a> <a id="4712" class="Symbol">=</a> <a id="4714" href="StreamFun.html#4276" class="Function">zip∘unzip</a>

<a id="4725" class="Comment">-- tl-≈ (delay⊗ {a₀ = a₀}{b₀} ps) =</a>
<a id="4761" class="Comment">--   begin</a>
<a id="4772" class="Comment">--     tl ((delay a₀ ⊗ delay b₀) ps)</a>
<a id="4809" class="Comment">--   ≡⟨⟩</a>
<a id="4818" class="Comment">--     tl (zip (map× (delay a₀) (delay b₀) (unzip ps)))</a>
<a id="4874" class="Comment">--   ≡⟨⟩</a>
<a id="4883" class="Comment">--     tl (zip (map× (delay a₀) (delay b₀) (map proj₁ ps , map proj₂ ps)))</a>
<a id="4958" class="Comment">--   ≡⟨⟩</a>
<a id="4967" class="Comment">--     tl (zip (delay a₀ (map proj₁ ps) , delay b₀ (map proj₂ ps)))</a>
<a id="5035" class="Comment">--   ≡⟨⟩</a>
<a id="5044" class="Comment">--     zip (tl (delay a₀ (map proj₁ ps)) , tl (delay b₀ (map proj₂ ps)))</a>
<a id="5117" class="Comment">--   ≡⟨⟩</a>
<a id="5126" class="Comment">--     zip (map proj₁ ps , map proj₂ ps)</a>
<a id="5167" class="Comment">--   ≡⟨⟩</a>
<a id="5176" class="Comment">--     zip (unzip ps)</a>
<a id="5198" class="Comment">--   ≈⟨ zip∘unzip ⟩</a>
<a id="5218" class="Comment">--     ps</a>
<a id="5228" class="Comment">--   ≡⟨⟩</a>
<a id="5237" class="Comment">--     tl (delay (a₀ , b₀) ps)</a>
<a id="5268" class="Comment">--   ∎</a>
<a id="5275" class="Comment">--  where open R</a>
</pre></body></html>